<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>To-do & Lá»‹ch há»c</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    .switch input { 
      opacity: 0; 
      width: 0; 
      height: 0; 
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      border-radius: 50%;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
    }
    input:checked + .slider {
      background-color: #2196F3;
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-3xl mx-auto">
    <!-- DÃ²ng hiá»ƒn thá»‹ ngÃ y Ã¢m lá»‹ch -->
    <div id="dateDisplayBlock" class="bg-yellow-50 text-yellow-700 font-medium rounded-t-lg p-2 text-center">
      <span id="lunarDate">Äang táº£i thÃ´ng tin lá»‹ch...</span>
    </div>
    <div class="bg-white rounded-lg shadow-lg p-6 rounded-t-none">
      <!-- Thá»i gian hiá»‡n táº¡i -->
      <div class="text-center mb-6">
        <h1 class="text-2xl font-bold text-blue-600">ğŸ•’ <span id="clock">--:--</span> | ğŸ“… <span id="date">--/--/----</span></h1>
      </div>

      <!-- Chuyá»ƒn Ä‘á»•i lá»‹ch -->
      <div class="text-center mb-6">
        <label class="switch">
          <input type="checkbox" id="switch"> <!-- Máº·c Ä‘á»‹nh lÃ  khÃ´ng check, tá»©c lÃ  áº©n -->
          <span class="slider"></span>
        </label>
        <p id="switchLabel" class="text-xl text-blue-700 mt-3">Hiá»‡n thÃ´ng tin lá»‹ch</p>
      </div>

      <!-- To-do list -->
      <h2 class="text-xl font-semibold text-blue-700 mb-2">ğŸ“‹ Danh sÃ¡ch viá»‡c cáº§n lÃ m</h2>
      <div class="flex mb-4 gap-2">
        <input id="taskInput" type="text" placeholder="Nháº­p cÃ´ng viá»‡c..." class="flex-grow border p-2 rounded" />
        <button onclick="addTask()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ThÃªm</button>
      </div>
      <ul id="taskList" class="space-y-3 mb-6"></ul>

      <!-- Lá»‹ch há»c -->
      <h2 class="text-xl font-semibold text-green-700 mb-2">ğŸ“š Lá»‹ch há»c / Thá»i gian biá»ƒu</h2>
      <div class="flex mb-4 gap-2">
        <input id="scheduleInput" type="text" placeholder="Nháº­p lá»‹ch há»c (VD: Thá»© 2 - ToÃ¡n 7h)" class="flex-grow border p-2 rounded" />
        <button onclick="addSchedule()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">ThÃªm</button>
      </div>
      <ul id="scheduleList" class="space-y-2"></ul>
    </div>
  </div>

  <script>
    // CÃ¡c máº£ng Can, Chi, vÃ  thÃ´ng sá»‘ thÃ¡ng cho lá»‹ch Ã¢m Viá»‡t Nam
    const CAN = ["GiÃ¡p", "áº¤t", "BÃ­nh", "Äinh", "Máº­u", "Ká»·", "Canh", "TÃ¢n", "NhÃ¢m", "QuÃ½"];
    const CHI = ["TÃ½", "Sá»­u", "Dáº§n", "MÃ£o", "ThÃ¬n", "Tá»µ", "Ngá»", "MÃ¹i", "ThÃ¢n", "Dáº­u", "Tuáº¥t", "Há»£i"];
    const LUNAR_MONTH_DAYS = [0, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29]; //ThÃ¡ng 0 khÃ´ng dÃ¹ng

    // HÃ m tÃ­nh lá»‹ch Ã¢m Viá»‡t Nam Ä‘Æ¡n giáº£n
    function getLunarDateVietnam(currentDate) {
        const solarYear = currentDate.getFullYear();
        const solarMonth = currentDate.getMonth() + 1;
        const solarDay = currentDate.getDate();
        
        // Má»‘c DÆ°Æ¡ng lá»‹ch: 01/01/2024 lÃ  ngÃ y 20 thÃ¡ng 11 nÄƒm QuÃ½ MÃ£o (2023 Ã‚m lá»‹ch)
        const epochSolarDate = new Date(2024, 0, 1); // 01/01/2024 DÆ°Æ¡ng lá»‹ch
        const epochLunarDay = 20;
        const epochLunarMonth = 11;
        const epochLunarYear = 2023; // QuÃ½ MÃ£o

        const diffTime = currentDate.getTime() - epochSolarDate.getTime();
        let diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

        let lunarDay = epochLunarDay + diffDays;
        let lunarMonth = epochLunarMonth;
        let lunarYear = epochLunarYear;

        // Äiá»u chá»‰nh ngÃ y Ã¢m
        // Logic nÃ y cáº§n Ä‘Æ°á»£c cáº£i thiá»‡n Ä‘á»ƒ chÃ­nh xÃ¡c hÆ¡n, Ä‘áº·c biá»‡t lÃ  vá»›i nÄƒm nhuáº­n
        // ÄÃ¢y lÃ  má»™t phÃ©p tÃ­nh Æ°á»›c lÆ°á»£ng Ä‘Æ¡n giáº£n
        while (true) {
            let daysInMonth = LUNAR_MONTH_DAYS[lunarMonth] || 29; // Máº·c Ä‘á»‹nh 29 ngÃ y náº¿u thÃ¡ng khÃ´ng cÃ³ trong máº£ng (vÃ­ dá»¥ thÃ¡ng nhuáº­n)
            // Giáº£ Ä‘á»‹nh Ä‘Æ¡n giáº£n cho nÄƒm nhuáº­n, thá»±c táº¿ phá»©c táº¡p hÆ¡n nhiá»u
            if (lunarYear % 4 === 0 && lunarMonth === 2) { // VÃ­ dá»¥ nÄƒm nhuáº­n cÃ³ thÃ¡ng 2 nhuáº­n (khÃ´ng chÃ­nh xÃ¡c)
                // daysInMonth = 29; // VÃ­ dá»¥
            }

            if (lunarDay > daysInMonth) {
                lunarDay -= daysInMonth;
                lunarMonth++;
                if (lunarMonth > 12) {
                    lunarMonth = 1;
                    lunarYear++;
                }
            } else if (lunarDay <= 0) { // Xá»­ lÃ½ trÆ°á»ng há»£p ngÃ y Ã¢m < 0 (khi tÃ­nh lÃ¹i)
                lunarMonth--;
                if (lunarMonth < 1) {
                    lunarMonth = 12;
                    lunarYear--;
                }
                daysInMonth = LUNAR_MONTH_DAYS[lunarMonth] || 29;
                lunarDay += daysInMonth;

            } else {
                break;
            }
        }
        
        const canYear = CAN[(lunarYear - 4 + 60) % 10]; // +60 Ä‘á»ƒ Ä‘áº£m báº£o sá»‘ dÆ°Æ¡ng
        const chiYear = CHI[(lunarYear - 4 + 60) % 12];

        return `NgÃ y Ã‚m Viá»‡t Nam: NgÃ y ${lunarDay} thÃ¡ng ${lunarMonth} nÄƒm ${canYear} ${chiYear}`;
    }

    // HÃ m tÃ­nh lá»‹ch TÃ¢y Táº¡ng (Dá»±ng má»™t phÃ©p tÃ­nh Ä‘Æ¡n giáº£n)
    function getTibetanDate(currentDate) {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth() + 1;
        const day = currentDate.getDate();
        const tibetanYear = year - 1959; // Losar (NÄƒm má»›i TÃ¢y Táº¡ng) thÆ°á»ng rÆ¡i vÃ o thÃ¡ng 2 DL. ÄÃ¢y lÃ  má»™t Æ°á»›c tÃ­nh ráº¥t thÃ´.
                                        // Äá»ƒ chÃ­nh xÃ¡c hÆ¡n, cáº§n má»™t thÆ° viá»‡n tÃ­nh lá»‹ch TÃ¢y Táº¡ng chuyÃªn dá»¥ng.
        return `NgÃ y Ã‚m TÃ¢y Táº¡ng: NgÃ y ${day} thÃ¡ng ${month} nÄƒm ${tibetanYear} (Æ°á»›c tÃ­nh)`;
    }

    // HÃ m láº¥y ngÃ y dÆ°Æ¡ng lá»‹ch Viá»‡t Nam (KhÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ hiá»ƒn thá»‹ trong khá»‘i lá»‹ch, nhÆ°ng cÃ³ thá»ƒ dÃ¹ng á»Ÿ chá»— khÃ¡c náº¿u cáº§n)
    function getSolarDateVietnam(currentDate) {
        return `NgÃ y DÆ°Æ¡ng (Viá»‡t Nam): ${currentDate.toLocaleDateString('vi-VN')}`;
    }

    // HÃ m láº¥y ngÃ y dÆ°Æ¡ng lá»‹ch TÃ¢y Táº¡ng (KhÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ hiá»ƒn thá»‹ trong khá»‘i lá»‹ch, nhÆ°ng cÃ³ thá»ƒ dÃ¹ng á»Ÿ chá»— khÃ¡c náº¿u cáº§n)
    function getSolarDateTibet(currentDate) {
        return `NgÃ y DÆ°Æ¡ng (TÃ¢y Táº¡ng): ${currentDate.toLocaleDateString('vi-VN')}`; // Hiá»ƒn thá»‹ theo Ä‘á»‹nh dáº¡ng VN cho dá»… Ä‘á»c
    }

    // Hiá»ƒn thá»‹ thá»i gian hiá»‡n táº¡i vÃ  tÃ­nh lá»‹ch
    function updateClock() {
        const now = new Date();
        const time = now.toLocaleTimeString('vi-VN');
        const date = now.toLocaleDateString('vi-VN');
        document.getElementById('clock').innerText = time;
        document.getElementById('date').innerText = date; // ÄÃ¢y lÃ  ngÃ y dÆ°Æ¡ng lá»‹ch chÃ­nh cá»§a trang

        try {
            const lunarVietnamStr = getLunarDateVietnam(now);
            const tibetanLunarStr = getTibetanDate(now);
            // const solarVietnamStr = getSolarDateVietnam(now); // ÄÃ£ bá»
            // const solarTibetStr = getSolarDateTibet(now); // ÄÃ£ bá»

            document.getElementById('lunarDate').innerHTML = `
                ${lunarVietnamStr} <br>
                ${tibetanLunarStr}
            `;
        } catch (e) {
            console.error("Lá»—i khi Æ°á»›c tÃ­nh lá»‹ch:", e);
            document.getElementById('lunarDate').innerText = "Lá»—i khi táº£i thÃ´ng tin lá»‹ch.";
        }
    }
    
    const dateDisplayBlock = document.getElementById('dateDisplayBlock');
    const switchInput = document.getElementById('switch');
    const switchLabel = document.getElementById('switchLabel');

    // Äá»•i tráº¡ng thÃ¡i áº©n/hiá»‡n cá»§a khá»‘i lá»‹ch vÃ  cáº­p nháº­t label
    switchInput.addEventListener('change', (event) => {
        if (event.target.checked) { // Náº¿u switch Ä‘Æ°á»£c check (báº­t) -> Hiá»‡n lá»‹ch
            dateDisplayBlock.classList.remove('hidden');
            switchLabel.innerText = 'áº¨n thÃ´ng tin lá»‹ch';
        } else { // Náº¿u switch khÃ´ng Ä‘Æ°á»£c check (táº¯t) -> áº¨n lá»‹ch
            dateDisplayBlock.classList.add('hidden');
            switchLabel.innerText = 'Hiá»‡n thÃ´ng tin lá»‹ch';
        }
        // KhÃ´ng cáº§n gá»i updateClock() á»Ÿ Ä‘Ã¢y vÃ¬ nÃ³ Ä‘Ã£ Ä‘Æ°á»£c gá»i bá»Ÿi setInterval
    });

    setInterval(updateClock, 1000); // Cáº­p nháº­t má»—i giÃ¢y

    // To-do list
    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    function renderTasks() {
        const list = document.getElementById("taskList");
        list.innerHTML = "";
        tasks.forEach((task, index) => {
            const li = document.createElement("li");
            li.className = "flex justify-between items-center bg-gray-50 border-l-4 p-3 rounded " + (task.done ? "border-green-400" : "border-gray-300");
            li.innerHTML = `
                <div class="flex items-center gap-2">
                    <input type="checkbox" ${task.done ? "checked" : ""} onchange="toggleDone(${index})" />
                    <span class="${task.done ? 'line-through text-gray-400' : ''}">${task.text}</span>
                </div>
                <button onclick="deleteTask(${index})" class="text-red-500 hover:underline">ğŸ—‘ï¸</button>
            `;
            list.appendChild(li);
        });
    }

    function addTask() {
        const input = document.getElementById("taskInput");
        const text = input.value.trim();
        if (text === "") {
            alert("Vui lÃ²ng nháº­p cÃ´ng viá»‡c.");
            return;
        }
        tasks.push({ text, done: false });
        localStorage.setItem("tasks", JSON.stringify(tasks));
        input.value = "";
        renderTasks();
    }

    function toggleDone(index) {
        tasks[index].done = !tasks[index].done;
        localStorage.setItem("tasks", JSON.stringify(tasks));
        renderTasks();
    }

    function deleteTask(index) {
        if (confirm("XoÃ¡ cÃ´ng viá»‡c nÃ y?")) {
            tasks.splice(index, 1);
            localStorage.setItem("tasks", JSON.stringify(tasks));
            renderTasks();
        }
    }

    // Lá»‹ch há»c
    let schedules = JSON.parse(localStorage.getItem("schedules")) || [];

    function renderSchedule() {
        const list = document.getElementById("scheduleList");
        list.innerHTML = "";
        schedules.forEach((item, index) => {
            const li = document.createElement("li");
            li.className = "bg-green-50 border-l-4 border-green-400 p-2 rounded flex justify-between items-center";
            li.innerHTML = `
                <span>${item}</span>
                <button onclick="deleteSchedule(${index})" class="text-red-500 hover:underline">ğŸ—‘ï¸</button>
            `;
            list.appendChild(li);
        });
    }

    function addSchedule() {
        const input = document.getElementById("scheduleInput");
        const text = input.value.trim();
        if (text === "") {
            alert("Vui lÃ²ng nháº­p lá»‹ch há»c.");
            return;
        }
        schedules.push(text);
        localStorage.setItem("schedules", JSON.stringify(schedules));
        input.value = "";
        renderSchedule();
    }

    function deleteSchedule(index) {
        if (confirm("XoÃ¡ lá»‹ch há»c nÃ y?")) {
            schedules.splice(index, 1);
            localStorage.setItem("schedules", JSON.stringify(schedules));
            renderSchedule();
        }
    }

    // Cháº¡y cÃ¡c hÃ m render vÃ  khá»Ÿi táº¡o khi DOM Ä‘Ã£ sáºµn sÃ ng
    document.addEventListener('DOMContentLoaded', () => {
        // Thiáº¿t láº­p tráº¡ng thÃ¡i ban Ä‘áº§u cho khá»‘i lá»‹ch dá»±a trÃªn switch
        if (switchInput.checked) {
            dateDisplayBlock.classList.remove('hidden');
            switchLabel.innerText = 'áº¨n thÃ´ng tin lá»‹ch';
        } else {
            dateDisplayBlock.classList.add('hidden');
            switchLabel.innerText = 'Hiá»‡n thÃ´ng tin lá»‹ch';
        }
        
        updateClock(); // Gá»i láº§n Ä‘áº§u Ä‘á»ƒ hiá»ƒn thá»‹ ngay
        renderTasks();
        renderSchedule();
    });
  </script>
</body>
</html>